# 第3章: ビットコインの暗号化技術
## 利用する暗号ライブラリ
Rubyを主に使用する
- openssl
- securerandom
- ruby_ecdsa
- bitcoin-ruby

### openssl 
rubyから使う際は require 'openssl' で呼び出せる

### 安全な乱数の重要性
ほとんどの暗号システムは擬似乱数を生成するシステムと言える
- それほど擬似乱数が予測不能な真の乱数にどれだけ近いかが重要
- コンピュータの計算でできる暗号鍵の生成や暗号化はシードと呼ばれる乱数の素を使う
    - シードが同じであれば最終的な出力は同じになってしまう
- コンピュータの時計をシードに使うのことはできない
    - 市販の高性能なPCでも2の50乗くらいの計算は実行できてしまう
    - 1μsの2の50乗は約35年にあたる
- ハードウェア乱数生成器が備わっている
    - AppleA7以降のプロセッサなどには熱雑音などを利用して物理的に乱数を発生させる
- エントロピープール
    - ハードウェアやデバイスドライバなどから発生するデータを乱数の素として大量に蓄積していく
    - LinuxやMacOSXはこの方式

### securerandomによる安全な乱数
- Rubyから安全な乱数を生成するためのライブラリ

### ruby_ecdsa
- OpenSSLにビットコインで利用されるECDSAという暗号技術を利用するための昨日が備わっているのでopensslライブラリで十分  
- ただし、細かいECDSAのテクニックを確認するにはruby_ecdsaが便利

### bitcoin-ruby
ビットコインの全ての基本機能をRubyで実装したライブラリ
- Bitcoin::Util
    - ビットコインの共通で使われる暗号処理やエンコーディングなどのユーティリティ
- Bitcoin::Protocol
    - ビットコインネットワークのプロトコルに沿ったメッセージの構文解析や生成
- Bitcoin::Script
    - ビットコインの備わっているスクリプト言語処理系のスクリプトの作成や実行と電子署名の検証など
- Bitcoin::Key
    - 暗号鍵やビットコインアドレスなどの様々な処理に関するAPI
- Bitcoin::Builder
    - トランザクションやブロックを作成するための高度なAPI

## ビットコインに利用されて炒る暗号技術の基本
ビットコインは枯れた技術の組み合わせによってできている

### 暗号学的ハッシュ関数
一方向関数

#### メッセージのダイジェスト
ある処理が同じ入力に対しては必ず同じ値を返す性質（決定性）がある

#### メッセージの完全性を検証する手段
1bitでも改ざんされていれば全く別の値になることを利用した安全性の検証

#### メッセージへのコミットメント
メッセージにnonce(一度きりしか使わないランダムな数値のこと)を追加した上でそのハッシュ値を計算し、ハッシュとメッセージのみを公開することで、そのnonceを知っている者にしか計算できない  
- ハッシュ値を実際に計算した人は使用したnonceを開示することによって、第三者に対して自分がそのメッセージのハッシュ値を本当に作成したことを証明できる  
- ハッシュ値を使ってメッセージとハッシュ計算を行った人間を確実に紐づけることをコミットメントと呼ぶ

ビットコインのマイニングとはnonceを変更しながらブロックのデータのハッシュ値を繰り返し計算すること
- マイニング競争とは次々とのんcえを変更しながらハッシュ値を計算し、それとターゲットと呼ばれる数値を比較し、世界で最初にターゲットよりも小さいハッシュ値を得たものが勝利者となる
- マイニングの結果得られるnonceのことをproof of workという

#### データ参照のためのポインタ
- ソフトウェア高額ではキーによって直接的にデータを参照できるデータ構造としてハッシュテーブルを使う方法がある
- ハッシュ値をメッセージとみなして再びそのハッシュ値を計算したり、ハッシュ値の間の連続構造を改変不可能にすることをハッシュチェーンと呼ぶ
- データの構造かに加えてデータ間の順序関係の維持、欠落や追加ができないことなどを証明するためのコミットメントとして利用が可能

#### データがコミットされたメンバーであることやメンバーでないことの証明手段としての利用方法
マークル木
- ハッシュチェーンの一つ
- 暗号学的ハッシュ関数のハッシュ値をポインタとして利用

#### 暗号学的ハッシュ関数の衝突耐性
- 別のメッセージから同じハッシュ値が出力されてしまうことをハッシュ値の衝突と呼ぶ
- 暗号学的ハッシュ関数は、ハッシュ値の衝突確率が極めて低い
- 理想の衝突確率はハッシュ値のサイズの平方根よりはよくできないとされる
    - ハッシュ値が160ビットの暗号学的ハッシュ関数であれば衝突耐性の理想は160ビットの平方根 = 1 / 2の80乗
- SHA-1の暗号学的ハッシュ関数(160ビット)は効率的な攻撃方法が見つかった
    - ハッシュ値の衝突確率を 1 / 2の61乗 まで増やすことができる
    - 条件次第では現実的に攻撃可能
    - 2017年2月23日、Googleが2つのPDFファイルのSHA-1ハッシュの衝突に成功

### ビットコインにおける暗号学的ハッシュ関数の利用
- ビットコインアドレスは公開鍵のダイジェスト
- ビットコインアドレスはチェックサムとしてハッシュ値の一部を利用
- トランザクションの識別子はトランザクションのハッシュ値
- ブロック内の情報や含まれるトランザクション群の内容への完全性の保証
- ブロックの連鎖構造（ブロックチェーン）においてブロックの順序の保持、追加や欠落を不可能にするコミットメント
- マイニング計算とそのコミットメント
- マイニング計算とそのコミットメント(HashCash法)
- トランザクションの恒星時に直前のトランザクションを参照するためのポインタ
- マークル木というハッシュ値のポインタによる木構造を利用したメンバー判定の効率化
- 検索ショアの検索対象に関するプライバシを守りながらブロック内のメンバーを探索するフィルタ（ブルームフィルタ）


































